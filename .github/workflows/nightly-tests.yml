name: ğŸŒ™ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù„ÙŠÙ„ÙŠØ© Ø´Ø§Ù…Ù„Ø©

on:
  schedule:
    # ØªØ´ØºÙŠÙ„ ÙŠÙˆÙ…ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© 3 ØµØ¨Ø§Ø­Ø§Ù‹
    - cron: '0 3 * * *'
  workflow_dispatch: # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ

env:
  NODE_VERSION: '20'

jobs:
  comprehensive-tests:
    name: ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø´Ø§Ù…Ù„Ø©
    runs-on: ubuntu-latest
    timeout-minutes: 60 # ÙˆÙ‚Øª Ø£Ø·ÙˆÙ„ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©
    
    steps:
      - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v5
        
      - name: ğŸŸ¢ Ø¥Ø¹Ø¯Ø§Ø¯ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          
      - name: ğŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: npm ci
        
      - name: ğŸ” ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„ÙƒÙˆØ¯
        run: npm run lint
        
      - name: ğŸ¨ ÙØ­Øµ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
        run: npm run format:check
        
      - name: ğŸ”’ ÙØ­Øµ Ø§Ù„Ø£Ù…Ø§Ù†
        run: npm audit --audit-level=moderate
        
      - name: ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø´Ø§Ù…Ù„Ø©
        run: npm test -- --run --reporter=verbose --pool=forks
        
      - name: ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø´Ø§Ù…Ù„
        run: npm run test:performance
        
      - name: ğŸ“ˆ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØºØ·ÙŠØ©
        run: npm run test:coverage
        
      - name: ğŸ’¾ Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        uses: actions/upload-artifact@v4
        with:
          name: nightly-test-results
          path: |
            test-performance/
            coverage/
            test-results.json
          retention-days: 30
          
      - name: ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ù„ÙŠÙ„ÙŠ
        run: |
          echo "## ğŸŒ™ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù„ÙŠÙ„ÙŠ - $(date)" >> nightly-report.md
          echo "" >> nightly-report.md
          echo "### ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª:" >> nightly-report.md
          echo "- **Ø§Ù„ØªØ§Ø±ÙŠØ®:** $(date)" >> nightly-report.md
          echo "- **Branch:** ${{ github.ref_name }}" >> nightly-report.md
          echo "- **Commit:** ${{ github.sha }}" >> nightly-report.md
          echo "" >> nightly-report.md
          echo "### ğŸ¯ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:" >> nightly-report.md
          echo "- ÙØ­Øµ Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯" >> nightly-report.md
          echo "- ÙØ­Øµ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚" >> nightly-report.md
          echo "- ÙØ­Øµ Ø§Ù„Ø£Ù…Ø§Ù†" >> nightly-report.md
          echo "- Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø´Ø§Ù…Ù„Ø©" >> nightly-report.md
          echo "- ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡" >> nightly-report.md
          echo "- Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØºØ·ÙŠØ©" >> nightly-report.md
          
      - name: ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        uses: actions/upload-artifact@v4
        with:
          name: nightly-report
          path: nightly-report.md
          retention-days: 30
          
      - name: ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        if: always()
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            let report = '## ğŸŒ™ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù„ÙŠÙ„ÙŠ\n\n';
            
            try {
              if (fs.existsSync('nightly-report.md')) {
                report = fs.readFileSync('nightly-report.md', 'utf8');
              }
            } catch (e) {
              report += '**Status:** ' + context.job.conclusion + '\n';
              report += '**Time:** ' + new Date().toISOString() + '\n';
            }
            
            // ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ Slack Ø£Ùˆ Discord Ù‡Ù†Ø§
            console.log('ğŸ“§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù„ÙŠÙ„ÙŠ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„');
            console.log(report);
