flowchart TD A[POST /auth/register] --> B[UserM: insert User] B --> C[Set verification code] C --> D[MerchantsService.create] D --> E[MerchantM: insert Merchant (defaults)] E --> F[N8nWorkflowService.createForMerchant] F -->|POST /workflows| G[n8n] G -->|workflowId| H[MerchantM: set workflowId] E --> I[Build finalPromptTemplate -> save] I --> J[Create Storefront] D --> K[return Merchant] K --> L[link user.merchantId -> save] L --> M[sendVerificationEmail(email, code)] M --> N[JWT sign -> return accessToken] subgraph Later O[POST /auth/verify-email] --> P[UserM: verify & cleanup] Q[PATCH /merchants/:id/onboarding/basic] --> R[MerchantM: update + rebuild prompt] S[PATCH /merchants/:id/product-source] --> T[MerchantM: update productSourceConfig] U[GET analytics/checklist] --> V[Dashboard Widgets] end
