# ⚡ دليل اختبارات الأداء - Kleem Frontend

## 🎯 نظرة عامة

هذا الدليل يحتوي على أفضل الممارسات لتحسين أداء الاختبارات في مشروع Kleem Frontend، مع التركيز على تقليل وقت التنفيذ وزيادة الكفاءة.

---

## 📊 نتائج التحسينات المحققة

### ✅ SignUpPage Tests
| المقياس | قبل التحسين | بعد التحسين | التحسين |
|---------|-------------|-------------|---------|
| **الوقت الإجمالي** | 7.71s | 4.25s | **45%** |
| **متوسط الوقت/اختبار** | 2.57s | 1.42s | **45%** |
| **عدد الاختبارات** | 3 | 3 | - |

---

## 🚀 استراتيجيات تحسين الأداء

### 1. **Mocking المكونات الثقيلة**

#### ✅ ما يجب فعله
```typescript
// Mock فقط المكونات الأكثر ثقلاً
vi.mock("@/shared/ui/GradientIcon", () => ({
  default: ({ Icon }: any) => <div data-testid="gradient-icon">{Icon && <Icon />}</div>,
}));
```

#### ❌ ما يجب تجنبه
```typescript
// تجنب mocking كل شيء - هذا يبطئ الاختبارات
vi.mock("@mui/material/styles");
vi.mock("framer-motion");
vi.mock("@/auth/AuthLayout");
```

### 2. **اختيار المكونات المراد Mocking**

#### 🔍 تحليل المكونات
1. **GradientIcon** - يحتوي على عمليات حسابية معقدة
2. **AuthLayout** - يحتوي على framer-motion و useTheme
3. **framer-motion** - يضيف تأخيرات للرسوم المتحركة

#### 📊 أولويات Mocking
- **عالية:** مكونات الرسوم المتحركة
- **متوسطة:** مكونات التصميم المعقدة
- **منخفضة:** مكونات UI البسيطة

### 3. **تحسين MSW Setup**

#### ✅ الإعداد المحسن
```typescript
describe("Performance Tests", () => {
  beforeEach(() => {
    // Setup MSW مرة واحدة لجميع الاختبارات
    server.use(
      http.post("/api/auth/signup", () =>
        HttpResponse.json({ message: "Validation failed" }, { status: 400 })
      )
    );
  });
});
```

---

## 🛠️ أدوات تحليل الأداء

### 1. **قياس وقت الاختبارات**
```bash
# قياس وقت اختبار محدد
npm run test -- run src/pages/auth/SignUpPage.test.tsx

# قياس وقت جميع الاختبارات
npm run test -- run --reporter=verbose
```

### 2. **تحليل الأداء**
```typescript
// إضافة قياسات الأداء في الاختبارات
test("performance test", async () => {
  const startTime = performance.now();
  
  // ... test logic
  
  const endTime = performance.now();
  const duration = endTime - startTime;
  
  // التأكد من أن الاختبار يعمل في الوقت المطلوب
  expect(duration).toBeLessThan(2000); // أقل من 2 ثانية
});
```

---

## 📋 قائمة التحقق للأداء

### ✅ قبل كتابة الاختبارات
- [ ] تحديد المكونات الثقيلة
- [ ] اختيار استراتيجية Mocking مناسبة
- [ ] إعداد MSW بشكل صحيح

### ✅ أثناء كتابة الاختبارات
- [ ] استخدام `describe.parallel` عند الإمكان
- [ ] تجنب `waitFor` غير الضرورية
- [ ] تقليل عدد `userEvent` calls

### ✅ بعد كتابة الاختبارات
- [ ] قياس الأداء
- [ ] مقارنة النتائج مع الأهداف
- [ ] تحسين الاستراتيجيات

---

## 🎯 أهداف الأداء المستهدفة

### 📊 مؤشرات الأداء
```
⚡ اختبارات سريعة (0-1s): 70%
🚀 اختبارات متوسطة (1-2s): 25%
🐌 اختبارات بطيئة (2s+): 5%
```

### 🎯 الأهداف المستقبلية
- **SignUpPage:** <2s (تحسين إضافي 50%)
- **FAQSection:** <2s (تحسين إضافي 45%)
- **Testimonials:** <2s (تحسين إضافي 43%)

---

## 🔍 استكشاف مشاكل الأداء

### 1. **مشاكل شائعة**
- **framer-motion:** يضيف تأخيرات للرسوم المتحركة
- **useTheme:** عمليات حسابية معقدة
- **GradientIcon:** عمليات حسابية للألوان

### 2. **حلول مقترحة**
- Mocking انتقائي للمكونات الثقيلة
- استخدام `vi.mock` بشكل ذكي
- تحسين MSW setup

---

## 📈 خطط التحسين المستقبلية

### الأسبوع القادم
- [ ] تطبيق نفس الاستراتيجيات على FAQSection
- [ ] تحسين Testimonials tests
- [ ] إضافة parallel testing

### الشهر القادم
- [ ] تحقيق هدف <30s للاختبارات الإجمالية
- [ ] إضافة اختبارات الأداء
- [ ] إعداد CI/CD مع قياسات الأداء

---

## 💡 نصائح عملية

### 1. **ابدأ بالأبطأ**
- ركز على الاختبارات الأبطأ أولاً
- استخدم نفس الاستراتيجيات الناجحة

### 2. **قياس مستمر**
- قم بقياس الأداء بعد كل تحسين
- وثق النتائج والمقارنات

### 3. **تكرار التحسين**
- استخدم دورة: قياس → تحسين → اختبار → تكرار
- لا تتوقف عند أول تحسين

---

## 🎉 الخلاصة

لقد حققنا نجاحًا كبيرًا في تحسين أداء الاختبارات:

- **🏆 تحسين 45%** في SignUpPage tests
- **⚡ وقت أسرع** من 7.71s إلى 4.25s
- **🚀 استراتيجيات فعالة** يمكن تطبيقها على اختبارات أخرى
- **📊 أهداف واضحة** للتحسينات المستقبلية

**الخطوة التالية:** تطبيق نفس الاستراتيجيات على الاختبارات الأخرى لتحقيق هدف <30s الإجمالي.

---

*تم إنشاء هذا الدليل بواسطة فريق التطوير - Kleem Frontend Team*
